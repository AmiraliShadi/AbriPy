<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AbriPy Framework Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            gap: 2rem;
            margin-top: 2rem;
        }

        .sidebar {
            width: 280px;
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .sidebar h3 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin-bottom: 0.5rem;
        }

        .sidebar a {
            color: #666;
            text-decoration: none;
            padding: 0.5rem 0.75rem;
            display: block;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .sidebar a:hover, .sidebar a.active {
            background: #667eea;
            color: white;
            transform: translateX(4px);
        }

        .main-content {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .section {
            margin-bottom: 3rem;
        }

        h2 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 1rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 0.5rem;
        }

        h3 {
            color: #34495e;
            font-size: 1.5rem;
            margin: 2rem 0 1rem 0;
        }

        h4 {
            color: #5a6c7d;
            font-size: 1.2rem;
            margin: 1.5rem 0 0.75rem 0;
        }

        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            margin: 1rem 0;
            overflow-x: auto;
        }

        .code-block pre {
            margin: 0;
            padding: 1rem;
            font-size: 0.9rem;
        }

        .highlight-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #f1f8e9 100%);
            border-left: 4px solid #667eea;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .feature-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .feature-card h4 {
            margin: 0 0 0.75rem 0;
            color: #667eea;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .btn {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background: #5a67d8;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: static;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }

        .tab-container {
            margin: 1rem 0;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #e9ecef;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }

        .tab-content {
            padding: 1rem 0;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        @media print {
            .sidebar { display: none; }
            .container { flex-direction: column; }
            .main-content { box-shadow: none; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <h1>üöÄ AbriPy Framework</h1>
            <p>Modern, Secure & Fast Python Web Framework</p>
        </div>
    </header>

    <div class="container">
        <nav class="sidebar">
            <h3>Navigation</h3>
            <ul>
                <li><a href="#introduction" class="nav-link">Introduction</a></li>
                <li><a href="#installation" class="nav-link">Installation</a></li>
                <li><a href="#quick-start" class="nav-link">Quick Start</a></li>
                <li><a href="#core-concepts" class="nav-link">Core Concepts</a></li>
                <li><a href="#routing" class="nav-link">Routing</a></li>
                <li><a href="#request-response" class="nav-link">Request & Response</a></li>
                <li><a href="#middleware" class="nav-link">Middleware</a></li>
                <li><a href="#websockets" class="nav-link">WebSockets</a></li>
                <li><a href="#security" class="nav-link">Security</a></li>
                <li><a href="#configuration" class="nav-link">Configuration</a></li>
                <li><a href="#examples" class="nav-link">Examples</a></li>
                <li><a href="#api-reference" class="nav-link">API Reference</a></li>
                <li><a href="#deployment" class="nav-link">Deployment</a></li>
                <li><a href="#troubleshooting" class="nav-link">Troubleshooting</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <section id="introduction" class="section">
                <h2>Introduction</h2>
                <p>AbriPy is a modern, secure, and fast Python web framework designed for building scalable web applications and APIs. Built on ASGI principles, it provides excellent performance while maintaining simplicity and developer experience.</p>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>‚ö° Lightning Fast</h4>
                        <p>Built on ASGI for maximum performance and async support</p>
                    </div>
                    <div class="feature-card">
                        <h4>üîí Security First</h4>
                        <p>Built-in security features including CSRF, XSS protection, and secure headers</p>
                    </div>
                    <div class="feature-card">
                        <h4>üéØ Developer Friendly</h4>
                        <p>Intuitive API with decorators and clean syntax</p>
                    </div>
                    <div class="feature-card">
                        <h4>üîå Extensible</h4>
                        <p>Middleware system and plugin architecture for customization</p>
                    </div>
                    <div class="feature-card">
                        <h4>üì° WebSocket Support</h4>
                        <p>Built-in WebSocket support for real-time applications</p>
                    </div>
                    <div class="feature-card">
                        <h4>üìä Monitoring</h4>
                        <p>Built-in health checks and monitoring endpoints</p>
                    </div>
                </div>
            </section>

            <section id="installation" class="section">
                <h2>Installation</h2>
                
                <h3>Requirements</h3>
                <ul>
                    <li>Python 3.8+</li>
                    <li>uvicorn (for ASGI server)</li>
                    <li>Optional: gunicorn (for production deployment)</li>
                </ul>

                <h3>Install via pip</h3>
                <div class="code-block">
                    <pre><code class="language-bash">pip install abripy</code></pre>
                </div>

                <h3>Development Installation</h3>
                <div class="code-block">
                    <pre><code class="language-bash"># Clone the repository
git clone https://github.com/yourusername/abripy.git
cd abripy

# Install in development mode
pip install -e .</code></pre>
                </div>
            </section>

            <section id="quick-start" class="section">
                <h2>Quick Start</h2>
                
                <p>Create your first AbriPy application in just a few lines of code:</p>
                
                <div class="code-block">
                    <pre><code class="language-python"># app.py
from core.application import AbriPy

app = AbriPy()

@app.get('/')
async def hello(request):
    return "Hello, AbriPy! üöÄ"

@app.get('/api/users/{user_id}')
async def get_user(request):
    user_id = request.path_params['user_id']
    return {"user_id": user_id, "name": "John Doe"}

@app.post('/api/users')
async def create_user(request):
    data = await request.json()
    return {"message": "User created", "data": data}

if __name__ == "__main__":
    app.run(host="127.0.0.1", port=8000, debug=True)</code></pre>
                </div>

                <h3>Run Your Application</h3>
                <div class="code-block">
                    <pre><code class="language-bash">python app.py</code></pre>
                </div>

                <div class="info-box">
                    <strong>üìù Important:</strong> All route handlers must accept a <code>request</code> parameter as their first argument, even if they don't use it.
                </div>
            </section>

            <section id="core-concepts" class="section">
                <h2>Core Concepts</h2>

                <h3>Application Instance</h3>
                <p>The AbriPy application instance is the central component of your web application:</p>
                
                <div class="code-block">
                    <pre><code class="language-python">from core.application import AbriPy
from core.config import Config

# Basic application
app = AbriPy()

# Application with custom configuration
config = Config()
config.server.host = "0.0.0.0"
config.server.port = 8080
app = AbriPy(config=config)</code></pre>
                </div>

                <h3>Route Handlers</h3>
                <p>Route handlers are async functions that process HTTP requests:</p>
                
                <div class="code-block">
                    <pre><code class="language-python">@app.get('/users')
async def list_users(request):
    # Handler logic here
    return {"users": []}

@app.post('/users')
async def create_user(request):
    data = await request.json()
    # Create user logic
    return {"id": 1, "name": data["name"]}</code></pre>
                </div>

                <h3>Middleware</h3>
                <p>Middleware provides a way to process requests and responses:</p>
                
                <div class="code-block">
                    <pre><code class="language-python">class LoggingMiddleware:
    def __init__(self, app):
        self.app = app
    
    async def __call__(self, scope, receive, send):
        print(f"Request: {scope['method']} {scope['path']}")
        await self.app(scope, receive, send)

app.middleware(LoggingMiddleware)</code></pre>
                </div>
            </section>

            <section id="routing" class="section">
                <h2>Routing</h2>
                
                <h3>Basic Routing</h3>
                <div class="code-block">
                    <pre><code class="language-python">@app.get('/')
async def home(request):
    return "Welcome to AbriPy!"

@app.post('/api/data')
async def handle_data(request):
    data = await request.json()
    return {"received": data}

@app.put('/api/users/{user_id}')
async def update_user(request):
    user_id = request.path_params['user_id']
    data = await request.json()
    return {"user_id": user_id, "updated": data}

@app.delete('/api/users/{user_id}')
async def delete_user(request):
    user_id = request.path_params['user_id']
    return {"message": f"User {user_id} deleted"}</code></pre>
                </div>

                <h3>Path Parameters</h3>
                <div class="code-block">
                    <pre><code class="language-python">@app.get('/users/{user_id}')
async def get_user(request):
    user_id = request.path_params['user_id']
    return {"user_id": user_id}

@app.get('/posts/{post_id}/comments/{comment_id}')
async def get_comment(request):
    post_id = request.path_params['post_id']
    comment_id = request.path_params['comment_id']
    return {
        "post_id": post_id, 
        "comment_id": comment_id
    }</code></pre>
                </div>

                <h3>Query Parameters</h3>
                <div class="code-block">
                    <pre><code class="language-python">@app.get('/search')
async def search(request):
    query = request.query_params.get('q', '')
    page = int(request.query_params.get('page', 1))
    limit = int(request.query_params.get('limit', 10))
    
    return {
        "query": query,
        "page": page,
        "limit": limit,
        "results": []
    }</code></pre>
                </div>

                <h3>Multiple HTTP Methods</h3>
                <div class="code-block">
                    <pre><code class="language-python">@app.route('/api/resource', methods=['GET', 'POST', 'PUT'])
async def handle_resource(request):
    if request.method == 'GET':
        return {"action": "get"}
    elif request.method == 'POST':
        data = await request.json()
        return {"action": "create", "data": data}
    elif request.method == 'PUT':
        data = await request.json()
        return {"action": "update", "data": data}</code></pre>
                </div>
            </section>

            <section id="request-response" class="section">
                <h2>Request & Response</h2>

                <h3>Request Object</h3>
                <div class="code-block">
                    <pre><code class="language-python">@app.post('/upload')
async def upload_file(request):
    # Access request method
    method = request.method
    
    # Access headers
    content_type = request.headers.get('content-type')
    
    # Access JSON data
    if content_type == 'application/json':
        data = await request.json()
    
    # Access form data
    elif content_type.startswith('multipart/form-data'):
        form = await request.form()
        file = form.get('file')
    
    # Access raw body
    body = await request.body()
    
    return {"received": len(body), "method": method}</code></pre>
                </div>

                <h3>Response Types</h3>
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="showTab('json-response')">JSON Response</button>
                        <button class="tab-button" onclick="showTab('html-response')">HTML Response</button>
                        <button class="tab-button" onclick="showTab('file-response')">File Response</button>
                        <button class="tab-button" onclick="showTab('redirect-response')">Redirect</button>
                    </div>
                    
                    <div id="json-response" class="tab-pane active">
                        <div class="code-block">
                            <pre><code class="language-python">from web.response import Response

@app.get('/api/data')
async def get_data(request):
    # Simple JSON response
    return {"message": "Hello", "status": "success"}

@app.get('/api/users')
async def get_users(request):
    # Using Response.json() method
    data = {"users": ["Alice", "Bob"], "count": 2}
    return Response.json(data, status_code=200)</code></pre>
                        </div>
                    </div>
                    
                    <div id="html-response" class="tab-pane">
                        <div class="code-block">
                            <pre><code class="language-python">@app.get('/page')
async def serve_page(request):
    html_content = """
    &lt;html&gt;
        &lt;head&gt;&lt;title&gt;AbriPy Page&lt;/title&gt;&lt;/head&gt;
        &lt;body&gt;
            &lt;h1&gt;Welcome to AbriPy!&lt;/h1&gt;
            &lt;p&gt;This is a sample HTML page.&lt;/p&gt;
        &lt;/body&gt;
    &lt;/html&gt;
    """
    return Response.html(html_content)</code></pre>
                        </div>
                    </div>
                    
                    <div id="file-response" class="tab-pane">
                        <div class="code-block">
                            <pre><code class="language-python">@app.get('/download/{filename}')
async def download_file(request):
    filename = request.path_params['filename']
    return Response.file(f"files/{filename}")</code></pre>
                        </div>
                    </div>
                    
                    <div id="redirect-response" class="tab-pane">
                        <div class="code-block">
                            <pre><code class="language-python">@app.get('/old-page')
async def redirect_page(request):
    return Response.redirect('/new-page')

@app.get('/login')
async def login_redirect(request):
    return Response.redirect('https://auth.example.com/login', status_code=302)</code></pre>
                        </div>
                    </div>
                </div>

                <h3>Custom Headers and Status Codes</h3>
                <div class="code-block">
                    <pre><code class="language-python">@app.post('/api/users')
async def create_user(request):
    data = await request.json()
    
    # Custom headers and status code
    response = Response.json(
        {"id": 123, "name": data["name"]},
        status_code=201,
        headers={
            "X-Custom-Header": "AbriPy",
            "X-User-Created": "true"
        }
    )
    return response</code></pre>
                </div>
            </section>

            <section id="middleware" class="section">
                <h2>Middleware</h2>
                
                <p>Middleware allows you to process requests and responses in a pipeline pattern.</p>

                <h3>Creating Middleware</h3>
                <div class="code-block">
                    <pre><code class="language-python">class TimingMiddleware:
    def __init__(self, app):
        self.app = app
    
    async def __call__(self, scope, receive, send):
        import time
        start_time = time.time()
        
        await self.app(scope, receive, send)
        
        process_time = time.time() - start_time
        print(f"Request processed in {process_time:.4f} seconds")

# Apply middleware
app.middleware(TimingMiddleware)</code></pre>
                </div>

                <h3>Authentication Middleware</h3>
                <div class="code-block">
                    <pre><code class="language-python">class AuthMiddleware:
    def __init__(self, app):
        self.app = app
    
    async def __call__(self, scope, receive, send):
        # Skip auth for public endpoints
        if scope["path"].startswith("/public"):
            await self.app(scope, receive, send)
            return
        
        headers = dict(scope.get("headers", []))
        auth_header = headers.get(b"authorization")
        
        if not auth_header or not self.validate_token(auth_header.decode()):
            response = Response("Unauthorized", status_code=401)
            await response(scope, receive, send)
            return
        
        await self.app(scope, receive, send)
    
    def validate_token(self, token):
        # Token validation logic
        return token.startswith("Bearer ")

app.middleware(AuthMiddleware)</code></pre>
                </div>

                <h3>CORS Middleware</h3>
                <div class="code-block">
                    <pre><code class="language-python">class CORSMiddleware:
    def __init__(self, app, allow_origins=["*"], allow_methods=["*"]):
        self.app = app
        self.allow_origins = allow_origins
        self.allow_methods = allow_methods
    
    async def __call__(self, scope, receive, send):
        if scope["type"] != "http":
            await self.app(scope, receive, send)
            return
        
        # Handle preflight requests
        if scope["method"] == "OPTIONS":
            response = Response("OK", headers={
                "Access-Control-Allow-Origin": "*",
                "Access-Control-Allow-Methods": ", ".join(self.allow_methods),
                "Access-Control-Allow-Headers": "Content-Type, Authorization",
            })
            await response(scope, receive, send)
            return
        
        await self.app(scope, receive, send)

app.middleware(CORSMiddleware)</code></pre>
                </div>
            </section>

            <section id="websockets" class="section">
                <h2>WebSockets</h2>
                
                <h3>Basic WebSocket Handler</h3>
                <div class="code-block">
                    <pre><code class="language-python">@app.websocket('/ws')
async def websocket_endpoint(websocket):
    await websocket.accept()
    
    try:
        while True:
            # Receive message from client
            message = await websocket.receive_text()
            
            # Echo message back to client
            await websocket.send_text(f"Echo: {message}")
    except Exception as e:
        print(f"WebSocket error: {e}")
    finally:
        await websocket.close()</code></pre>
                </div>

                <h3>WebSocket Chat Room</h3>
                <div class="code-block">
                    <pre><code class="language-python">class ConnectionManager:
    def __init__(self):
        self.active_connections = []
    
    async def connect(self, websocket):
        await websocket.accept()
        self.active_connections.append(websocket)
    
    def disconnect(self, websocket):
        self.active_connections.remove(websocket)
    
    async def broadcast(self, message):
        for connection in self.active_connections:
            try:
                await connection.send_text(message)
            except:
                self.disconnect(connection)

manager = ConnectionManager()

@app.websocket('/chat')
async def chat_endpoint(websocket):
    await manager.connect(websocket)
    
    try:
        while True:
            message = await websocket.receive_text()
            await manager.broadcast(message)
    except Exception as e:
        manager.disconnect(websocket)</code></pre>
                </div>
            </section>

            <section id="security" class="section">
                <h2>Security</h2>
                
                <h3>CSRF Protection</h3>
                <div class="code-block">
                    <pre><code class="language-python">from core.security import csrf_protect

@app.post('/api/transfer')
@csrf_protect
async def transfer_money(request):
    data = await request.json()
    # Transfer logic here
    return {"status": "success"}</code></pre>
                </div>

                <h3>Rate Limiting</h3>
                <div class="code-block">
                    <pre><code class="language-python">from core.security import rate_limit

@app.get('/api/search')
@rate_limit(max_requests=100, window_seconds=3600)  # 100 requests per hour
async def search_api(request):
    query = request.query_params.get('q')
    # Search logic here
    return {"results": []}</code></pre>
                </div>

                <h3>Input Validation</h3>
                <div class="code-block">
                    <pre><code class="language-python">from pydantic import BaseModel, validator

class UserCreate(BaseModel):
    username: str
    email: str
    password: str
    
    @validator('username')
    def username_must_be_alphanumeric(cls, v):
        assert v.isalnum(), 'Username must be alphanumeric'
        return v
    
    @validator('password')
    def password_must_be_strong(cls, v):
        if len(v) < 8:
            raise ValueError('Password must be at least 8 characters')
        return v

@app.post('/api/users')
async def create_user(request):
    data = await request.json()
    
    try:
        user_data = UserCreate(**data)
        # Create user logic
        return {"message": "User created successfully"}
    except Exception as e:
        return {"error": str(e)}</code></pre>
                </div>
            </section>

            <section id="configuration" class="section">
                <h2>Configuration</h2>
                
                <h3>Configuration Classes</h3>
                <div class="code-block">
                    <pre><code class="language-python">from core.config import Config

# Create configuration
config = Config()

# Server configuration
config.server.host = "0.0.0.0"
config.server.port = 8000
config.server.debug = True

# Security configuration
config.security.secret_key = "your-secret-key"
config.security.session_cookie_secure = True
config.security.csrf_enabled = True

# Database configuration (if using)
config.database.url = "postgresql://user:pass@localhost/db"
config.database.pool_size = 10

# Create app with configuration
app = AbriPy(config=config)</code></pre>
                </div>

                <h3>Environment Variables</h3>
                <div class="code-block">
                    <pre><code class="language-python"># Load configuration from environment
import os
from core.config import Config

config = Config()
config.server.host = os.getenv("HOST", "127.0.0.1")
                config.server.port = int(os.getenv("PORT", "8000"))
config.server.debug = os.getenv("DEBUG", "False").lower() == "true"
config.security.secret_key = os.getenv("SECRET_KEY")

app = AbriPy(config=config)</code></pre>
                </div>

                <h3>Configuration from File</h3>
                <div class="code-block">
                    <pre><code class="language-python"># config.yaml
server:
  host: "0.0.0.0"
  port: 8000
  debug: false

security:
  secret_key: "your-secret-key-here"
  csrf_enabled: true
  session_cookie_secure: true

database:
  url: "sqlite:///app.db"
  pool_size: 5</code></pre>
                </div>

                <div class="code-block">
                    <pre><code class="language-python"># Load from YAML file
import yaml
from core.config import Config

def load_config_from_yaml(file_path):
    with open(file_path, 'r') as file:
        data = yaml.safe_load(file)
    
    config = Config()
    
    # Map YAML data to config object
    if 'server' in data:
        config.server.host = data['server'].get('host', '127.0.0.1')
        config.server.port = data['server'].get('port', 8000)
        config.server.debug = data['server'].get('debug', False)
    
    if 'security' in data:
        config.security.secret_key = data['security'].get('secret_key')
        config.security.csrf_enabled = data['security'].get('csrf_enabled', True)
    
    return config

# Usage
config = load_config_from_yaml('config.yaml')
app = AbriPy(config=config)</code></pre>
                </div>
            </section>

            <section id="examples" class="section">
                <h2>Examples</h2>
                
                <h3>Simple Blog API</h3>
                <div class="code-block">
                    <pre><code class="language-python"># blog_api.py
from core.application import AbriPy
from web.response import Response
import json

app = AbriPy()

# In-memory storage (use a real database in production)
posts = []
next_id = 1

@app.get('/api/posts')
async def get_posts(request):
    """Get all blog posts"""
    return {"posts": posts, "count": len(posts)}

@app.get('/api/posts/{post_id}')
async def get_post(request):
    """Get a specific blog post"""
    post_id = int(request.path_params['post_id'])
    
    for post in posts:
        if post['id'] == post_id:
            return post
    
    return Response.json(
        {"error": "Post not found"}, 
        status_code=404
    )

@app.post('/api/posts')
async def create_post(request):
    """Create a new blog post"""
    global next_id
    
    data = await request.json()
    
    # Validate required fields
    if not data.get('title') or not data.get('content'):
        return Response.json(
            {"error": "Title and content are required"}, 
            status_code=400
        )
    
    new_post = {
        "id": next_id,
        "title": data['title'],
        "content": data['content'],
        "author": data.get('author', 'Anonymous'),
        "created_at": "2025-07-20T12:00:00Z"
    }
    
    posts.append(new_post)
    next_id += 1
    
    return Response.json(new_post, status_code=201)

@app.put('/api/posts/{post_id}')
async def update_post(request):
    """Update an existing blog post"""
    post_id = int(request.path_params['post_id'])
    data = await request.json()
    
    for i, post in enumerate(posts):
        if post['id'] == post_id:
            posts[i].update({
                "title": data.get('title', post['title']),
                "content": data.get('content', post['content']),
                "author": data.get('author', post['author'])
            })
            return posts[i]
    
    return Response.json(
        {"error": "Post not found"}, 
        status_code=404
    )

@app.delete('/api/posts/{post_id}')
async def delete_post(request):
    """Delete a blog post"""
    post_id = int(request.path_params['post_id'])
    
    for i, post in enumerate(posts):
        if post['id'] == post_id:
            deleted_post = posts.pop(i)
            return {"message": "Post deleted", "post": deleted_post}
    
    return Response.json(
        {"error": "Post not found"}, 
        status_code=404
    )

if __name__ == "__main__":
    app.run(debug=True)</code></pre>
                </div>

                <h3>File Upload API</h3>
                <div class="code-block">
                    <pre><code class="language-python"># file_upload.py
from core.application import AbriPy
from web.response import Response
import os
import uuid

app = AbriPy()

# Create uploads directory
UPLOAD_DIR = "uploads"
os.makedirs(UPLOAD_DIR, exist_ok=True)

@app.get('/')
async def upload_form(request):
    """Serve upload form"""
    html = """
    <!DOCTYPE html>
    <html>
    <head>
        <title>File Upload</title>
    </head>
    <body>
        <h1>Upload File</h1>
        <form action="/upload" method="post" enctype="multipart/form-data">
            <input type="file" name="file" required>
            <button type="submit">Upload</button>
        </form>
    </body>
    </html>
    """
    return Response.html(html)

@app.post('/upload')
async def upload_file(request):
    """Handle file upload"""
    try:
        form = await request.form()
        file = form.get('file')
        
        if not file or not file.filename:
            return Response.json(
                {"error": "No file provided"}, 
                status_code=400
            )
        
        # Generate unique filename
        file_extension = os.path.splitext(file.filename)[1]
        unique_filename = f"{uuid.uuid4()}{file_extension}"
        file_path = os.path.join(UPLOAD_DIR, unique_filename)
        
        # Save file
        content = await file.read()
        with open(file_path, 'wb') as f:
            f.write(content)
        
        return {
            "message": "File uploaded successfully",
            "filename": unique_filename,
            "original_name": file.filename,
            "size": len(content)
        }
        
    except Exception as e:
        return Response.json(
            {"error": f"Upload failed: {str(e)}"}, 
            status_code=500
        )

@app.get('/files/{filename}')
async def download_file(request):
    """Download uploaded file"""
    filename = request.path_params['filename']
    file_path = os.path.join(UPLOAD_DIR, filename)
    
    if not os.path.exists(file_path):
        return Response.json(
            {"error": "File not found"}, 
            status_code=404
        )
    
    return Response.file(file_path)

@app.get('/api/files')
async def list_files(request):
    """List uploaded files"""
    files = []
    for filename in os.listdir(UPLOAD_DIR):
        file_path = os.path.join(UPLOAD_DIR, filename)
        if os.path.isfile(file_path):
            files.append({
                "filename": filename,
                "size": os.path.getsize(file_path)
            })
    
    return {"files": files}

if __name__ == "__main__":
    app.run(debug=True)</code></pre>
                </div>

                <h3>Real-time Chat Application</h3>
                <div class="code-block">
                    <pre><code class="language-python"># chat_app.py
from core.application import AbriPy
from web.response import Response
import json
from datetime import datetime

app = AbriPy()

class ChatManager:
    def __init__(self):
        self.connections = {}
        self.messages = []
    
    async def connect(self, websocket, username):
        await websocket.accept()
        self.connections[username] = websocket
        
        # Send recent messages to new user
        for message in self.messages[-10:]:  # Last 10 messages
            await websocket.send_text(json.dumps(message))
        
        # Notify others about new user
        await self.broadcast({
            "type": "user_joined",
            "username": username,
            "timestamp": datetime.now().isoformat()
        }, exclude=username)
    
    def disconnect(self, username):
        if username in self.connections:
            del self.connections[username]
    
    async def broadcast(self, message, exclude=None):
        for username, websocket in self.connections.items():
            if username != exclude:
                try:
                    await websocket.send_text(json.dumps(message))
                except:
                    self.disconnect(username)
    
    async def send_message(self, username, content):
        message = {
            "type": "message",
            "username": username,
            "content": content,
            "timestamp": datetime.now().isoformat()
        }
        
        self.messages.append(message)
        # Keep only last 100 messages
        if len(self.messages) > 100:
            self.messages = self.messages[-100:]
        
        await self.broadcast(message)

chat_manager = ChatManager()

@app.get('/')
async def chat_page(request):
    """Serve chat page"""
    html = """
    <!DOCTYPE html>
    <html>
    <head>
        <title>AbriPy Chat</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            #messages { border: 1px solid #ccc; height: 400px; 
                       overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
            #messageInput { width: 70%; padding: 5px; }
            #sendButton { padding: 5px 10px; }
            .message { margin: 5px 0; }
            .username { font-weight: bold; color: #007bff; }
            .timestamp { font-size: 0.8em; color: #666; }
        </style>
    </head>
    <body>
        <h1>AbriPy Chat Room</h1>
        <div id="messages"></div>
        <div>
            <input type="text" id="messageInput" placeholder="Type your message...">
            <button id="sendButton">Send</button>
        </div>
        
        <script>
            const username = prompt("Enter your username:");
            if (!username) location.reload();
            
            const ws = new WebSocket(`ws://localhost:8000/chat/${username}`);
            const messages = document.getElementById('messages');
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            
            ws.onmessage = function(event) {
                const message = JSON.parse(event.data);
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                
                if (message.type === 'message') {
                    messageDiv.innerHTML = `
                        <span class="username">${message.username}:</span>
                        ${message.content}
                        <span class="timestamp">${new Date(message.timestamp).toLocaleTimeString()}</span>
                    `;
                } else if (message.type === 'user_joined') {
                    messageDiv.innerHTML = `<em>${message.username} joined the chat</em>`;
                }
                
                messages.appendChild(messageDiv);
                messages.scrollTop = messages.scrollHeight;
            };
            
            function sendMessage() {
                const content = messageInput.value.trim();
                if (content) {
                    ws.send(content);
                    messageInput.value = '';
                }
            }
            
            sendButton.onclick = sendMessage;
            messageInput.onkeypress = function(e) {
                if (e.key === 'Enter') sendMessage();
            };
        </script>
    </body>
    </html>
    """
    return Response.html(html)

@app.websocket('/chat/{username}')
async def chat_websocket(websocket):
    username = websocket.path_params['username']
    
    await chat_manager.connect(websocket, username)
    
    try:
        while True:
            message = await websocket.receive_text()
            await chat_manager.send_message(username, message)
    except Exception as e:
        print(f"Chat error for {username}: {e}")
    finally:
        chat_manager.disconnect(username)

if __name__ == "__main__":
    app.run(debug=True)</code></pre>
                </div>
            </section>

            <section id="api-reference" class="section">
                <h2>API Reference</h2>
                
                <h3>AbriPy Class</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Description</th>
                            <th>Parameters</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>__init__(config=None)</code></td>
                            <td>Initialize AbriPy application</td>
                            <td><code>config</code>: Optional Config object</td>
                        </tr>
                        <tr>
                            <td><code>get(path)</code></td>
                            <td>Register GET route</td>
                            <td><code>path</code>: URL path pattern</td>
                        </tr>
                        <tr>
                            <td><code>post(path)</code></td>
                            <td>Register POST route</td>
                            <td><code>path</code>: URL path pattern</td>
                        </tr>
                        <tr>
                            <td><code>put(path)</code></td>
                            <td>Register PUT route</td>
                            <td><code>path</code>: URL path pattern</td>
                        </tr>
                        <tr>
                            <td><code>delete(path)</code></td>
                            <td>Register DELETE route</td>
                            <td><code>path</code>: URL path pattern</td>
                        </tr>
                        <tr>
                            <td><code>websocket(path)</code></td>
                            <td>Register WebSocket route</td>
                            <td><code>path</code>: URL path pattern</td>
                        </tr>
                        <tr>
                            <td><code>middleware(middleware_class)</code></td>
                            <td>Add middleware</td>
                            <td><code>middleware_class</code>: Middleware class</td>
                        </tr>
                        <tr>
                            <td><code>run(host, port, debug)</code></td>
                            <td>Run the application</td>
                            <td><code>host</code>, <code>port</code>, <code>debug</code>: Server options</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Request Class</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Property/Method</th>
                            <th>Description</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>method</code></td>
                            <td>HTTP method (GET, POST, etc.)</td>
                            <td>string</td>
                        </tr>
                        <tr>
                            <td><code>path</code></td>
                            <td>Request path</td>
                            <td>string</td>
                        </tr>
                        <tr>
                            <td><code>headers</code></td>
                            <td>Request headers</td>
                            <td>dict</td>
                        </tr>
                        <tr>
                            <td><code>path_params</code></td>
                            <td>Path parameters</td>
                            <td>dict</td>
                        </tr>
                        <tr>
                            <td><code>query_params</code></td>
                            <td>Query parameters</td>
                            <td>dict</td>
                        </tr>
                        <tr>
                            <td><code>json()</code></td>
                            <td>Parse JSON body</td>
                            <td>async method</td>
                        </tr>
                        <tr>
                            <td><code>form()</code></td>
                            <td>Parse form data</td>
                            <td>async method</td>
                        </tr>
                        <tr>
                            <td><code>body()</code></td>
                            <td>Get raw body</td>
                            <td>async method</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Response Class</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Description</th>
                            <th>Parameters</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>Response(content, status_code, headers)</code></td>
                            <td>Create response</td>
                            <td>content, status_code=200, headers=None</td>
                        </tr>
                        <tr>
                            <td><code>Response.json(data, status_code, headers)</code></td>
                            <td>Create JSON response</td>
                            <td>data, status_code=200, headers=None</td>
                        </tr>
                        <tr>
                            <td><code>Response.html(content, status_code, headers)</code></td>
                            <td>Create HTML response</td>
                            <td>content, status_code=200, headers=None</td>
                        </tr>
                        <tr>
                            <td><code>Response.file(file_path, headers)</code></td>
                            <td>Create file response</td>
                            <td>file_path, headers=None</td>
                        </tr>
                        <tr>
                            <td><code>Response.redirect(url, status_code)</code></td>
                            <td>Create redirect response</td>
                            <td>url, status_code=302</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section id="deployment" class="section">
                <h2>Deployment</h2>
                
                <h3>Production with Gunicorn</h3>
                <div class="code-block">
                    <pre><code class="language-bash"># Install gunicorn
pip install gunicorn

# Run with gunicorn
gunicorn -w 4 -k uvicorn.workers.UvicornWorker app:app</code></pre>
                </div>

                <h3>Docker Deployment</h3>
                <div class="code-block">
                    <pre><code class="language-dockerfile"># Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["gunicorn", "-w", "4", "-k", "uvicorn.workers.UvicornWorker", 
     "--host", "0.0.0.0", "--port", "8000", "app:app"]</code></pre>
                </div>

                <div class="code-block">
                    <pre><code class="language-bash"># Build and run
docker build -t abripy-app .
docker run -p 8000:8000 abripy-app</code></pre>
                </div>

                <h3>Environment Configuration</h3>
                <div class="code-block">
                    <pre><code class="language-bash"># .env file
HOST=0.0.0.0
PORT=8000
DEBUG=false
SECRET_KEY=your-production-secret-key
DATABASE_URL=postgresql://user:pass@localhost/prod_db</code></pre>
                </div>
            </section>

            <section id="troubleshooting" class="section">
                <h2>Troubleshooting</h2>
                
                <h3>Common Issues</h3>
                
                <h4>Route Handler Error: "takes 0 positional arguments but 1 was given"</h4>
                <div class="warning-box">
                    <strong>Problem:</strong> Route handlers not accepting the request parameter.
                </div>
                
                <div class="code-block">
                    <pre><code class="language-python"># ‚ùå Incorrect - Missing request parameter
@app.get('/')
async def hello():
    return "Hello!"

# ‚úÖ Correct - Include request parameter
@app.get('/')
async def hello(request):
    return "Hello!"</code></pre>
                </div>

                <h4>Import Errors</h4>
                <div class="warning-box">
                    <strong>Problem:</strong> Module import issues.
                </div>
                
                <div class="code-block">
                    <pre><code class="language-python"># Make sure your imports are correct
from core.application import AbriPy  # Not from abripy.application
from web.response import Response    # Not from abripy.response
from core.config import Config       # Not from abripy.config</code></pre>
                </div>

                <h4>WebSocket Connection Issues</h4>
                <div class="info-box">
                    <strong>Tip:</strong> Ensure your WebSocket routes are properly configured and the client is connecting to the correct URL.
                </div>

                <h4>Middleware Order</h4>
                <div class="info-box">
                    <strong>Tip:</strong> Middleware is executed in the order it's added. Authentication middleware should typically be added before route-specific middleware.
                </div>

                <h3>Debug Mode</h3>
                <div class="code-block">
                    <pre><code class="language-python"># Enable debug mode for detailed error messages
app.run(debug=True)

# Or set in configuration
config = Config()
config.server.debug = True
app = AbriPy(config=config)</code></pre>
                </div>

                <h3>Logging</h3>
                <div class="code-block">
                    <pre><code class="language-python">import logging

# Configure logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

logger = logging.getLogger(__name__)

@app.get('/api/data')
async def get_data(request):
    logger.info("Data requested")
    try:
        # Your logic here
        return {"data": "example"}
    except Exception as e:
        logger.error(f"Error in get_data: {e}")
        raise</code></pre>
                </div>
            </section>
        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 AbriPy Framework. Built with ‚ù§Ô∏è for developers.</p>
            <p>
                <a href="https://github.com/yourusername/abripy" style="color: white; text-decoration: none;">GitHub</a> |
                <a href="https://pypi.org/project/abripy" style="color: white; text-decoration: none;">PyPI</a> |
                <a href="#" style="color: white; text-decoration: none;">Documentation</a>
            </p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    
    <script>
        // Navigation functionality
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.section');
            
            // Smooth scrolling
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);
                    
                    if (targetSection) {
                        targetSection.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                        
                        // Update active link
                        navLinks.forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    }
                });
            });
            
            // Highlight current section on scroll
            window.addEventListener('scroll', function() {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.clientHeight;
                    if (pageYOffset >= sectionTop - 200) {
                        current = section.getAttribute('id');
                    }
                });
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === '#' + current) {
                        link.classList.add('active');
                    }
                });
            });
        });
        
        // Tab functionality
        function showTab(tabId) {
            // Hide all tab panes
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab pane
            document.getElementById(tabId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        // Copy code functionality
        document.addEventListener('DOMContentLoaded', function() {
            const codeBlocks = document.querySelectorAll('.code-block pre code');
            
            codeBlocks.forEach(block => {
                const button = document.createElement('button');
                button.className = 'copy-button';
                button.textContent = 'Copy';
                button.style.cssText = `
                    position: absolute;
                    top: 8px;
                    right: 8px;
                    background: #667eea;
                    color: white;
                    border: none;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    cursor: pointer;
                    opacity: 0;
                    transition: opacity 0.3s;
                `;
                
                const container = block.closest('.code-block');
                container.style.position = 'relative';
                container.appendChild(button);
                
                container.addEventListener('mouseenter', () => {
                    button.style.opacity = '1';
                });
                
                container.addEventListener('mouseleave', () => {
                    button.style.opacity = '0';
                });
                
                button.addEventListener('click', () => {
                    const text = block.textContent;
                    navigator.clipboard.writeText(text).then(() => {
                        button.textContent = 'Copied!';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
            });
        });
        
        // Search functionality
        function addSearchFeature() {
            const searchContainer = document.createElement('div');
            searchContainer.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <input type="text" id="search-input" placeholder="Search documentation..." 
                           style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                </div>
            `;
            
            const sidebar = document.querySelector('.sidebar');
            sidebar.insertBefore(searchContainer, sidebar.firstChild);
            
            const searchInput = document.getElementById('search-input');
            const sections = document.querySelectorAll('.section');
            
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                
                sections.forEach(section => {
                    const content = section.textContent.toLowerCase();
                    const isVisible = content.includes(query) || query === '';
                    section.style.display = isVisible ? 'block' : 'none';
                });
            });
        }
        
        // Initialize search
        document.addEventListener('DOMContentLoaded', addSearchFeature);
        
        // Print styles
        window.addEventListener('beforeprint', function() {
            document.querySelectorAll('.sidebar').forEach(el => {
                el.style.display = 'none';
            });
        });
        
        window.addEventListener('afterprint', function() {
            document.querySelectorAll('.sidebar').forEach(el => {
                el.style.display = 'block';
            });
        });
    </script>
</body>
</html>
